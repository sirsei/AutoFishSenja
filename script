-- Load Rayfield UI Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Create the main window
local Window = Rayfield:CreateWindow({
    Name = "SENJA AUTOFISH V1",
    LoadingTitle = "Loading Bentar...",
    LoadingSubtitle = "by Sei",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "SeiAUTOFISH",
        FileName = "Config"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = true
    },
    KeySystem = false
})

-- Variables
local player = game:GetService("Players").LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local backpack = player:WaitForChild("Backpack")

-- Fungsi untuk mencari rod otomatis
local function FindRod()
    -- Cek rod di character dulu
    for _, tool in ipairs(character:GetChildren()) do
        if tool:IsA("Tool") and tool:FindFirstChild("Mechanics") and tool.Mechanics:FindFirstChild("Remotes") then
            return tool
        end
    end

    -- Kalau tidak ada, cari di backpack
    for _, tool in ipairs(backpack:GetChildren()) do
        if tool:IsA("Tool") and tool:FindFirstChild("Mechanics") and tool.Mechanics:FindFirstChild("Remotes") then
            player.Character:WaitForChild("Humanoid"):EquipTool(tool)
            task.wait(0.5)
            return tool
        end
    end

    return nil
end

-- Control variables
local isFishing = false
local announceEnabled = true
local antiAFKEnabled = true
local fishingLoop
local antiAFKConnection

-- Function to get latest fish
local function getLatestFish()
    for _, item in pairs(backpack:GetChildren()) do
        if item:IsA("Tool") and item.Name:find("kg") then
            return item
        end
    end
    return nil
end

-- Main auto fishing function
local function autoFish()
    local tool = FindRod()
    if not tool then
        Rayfield:Notify({
            Title = "Error",
            Content = "Tidak ada rod yang ditemukan di backpack atau tangan!",
            Duration = 4,
        })
        return
    end

    local mechanics = tool:WaitForChild("Mechanics")
    local remotes = mechanics:WaitForChild("Remotes")
    local castEvent = remotes:WaitForChild("CastEvent")
    local miniGameRemote = remotes:WaitForChild("MiniGame")
    local requestFishAnnouncement = game:GetService("ReplicatedStorage"):WaitForChild("RequestFishAnnouncement")

    -- Urutan lempar dan minigame
    castEvent:FireServer(true)
    task.wait(1)
    castEvent:FireServer(false, 100)
    task.wait(5)
    miniGameRemote:FireServer(true)

    -- Umumkan ikan yang didapat (opsional)
    if announceEnabled then
        local fish = getLatestFish()
        if fish then
            requestFishAnnouncement:FireServer(fish)
        end
    end
end

-- Function to sell rarity (tetap seperti aslinya)
local function sellRarity(rarity)
    local args = { rarity }
    game:GetService("ReplicatedStorage"):WaitForChild("RequestSellRarity"):InvokeServer(unpack(args))
    Rayfield:Notify({
        Title = "Sold Fish",
        Content = "Successfully sold " .. rarity .. " fish.",
        Duration = 3,
        Image = 4483362458,
    })
end

-- Initialize Anti-AFK
task.spawn(function()
    local VU = game:GetService("VirtualUser")
    antiAFKConnection = player.Idled:Connect(function()
        if antiAFKEnabled then
            VU:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
            task.wait(1)
            VU:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
        end
    end)
end)

-- Create Tabs
local FishingTab = Window:CreateTab("Fishing", 4483362458)
local SellingTab = Window:CreateTab("Selling", 4483362458)
local TeleportTab = Window:CreateTab("Teleport", 4483362458)

-- Fishing Tab Elements
FishingTab:CreateSection("Auto Fishing Controls")

local StartButton = FishingTab:CreateButton({
    Name = "Start Fishing",
    Callback = function()
        if not isFishing then
            isFishing = true
            Rayfield:Notify({
                Title = "Fishing Started",
                Content = "Auto fishing is now active.",
                Duration = 3,
            })
            fishingLoop = task.spawn(function()
                while isFishing do
                    autoFish()
                    task.wait(0.5)
                end
            end)
        end
    end,
})

local StopButton = FishingTab:CreateButton({
    Name = "Stop Fishing",
    Callback = function()
        if isFishing then
            isFishing = false
            Rayfield:Notify({
                Title = "Fishing Stopped",
                Content = "Auto fishing has been stopped.",
                Duration = 3,
            })
            if fishingLoop then
                task.cancel(fishingLoop)
            end
        end
    end,
})

FishingTab:CreateSection("Toggles")

local AnnouncementToggle = FishingTab:CreateToggle({
    Name = "Enable Announcement",
    CurrentValue = true,
    Flag = "AnnouncementToggle",
    Callback = function(Value)
        announceEnabled = Value
    end,
})

local AntiAFKToggle = FishingTab:CreateToggle({
    Name = "Enable Anti-AFK",
    CurrentValue = true,
    Flag = "AntiAFKToggle",
    Callback = function(Value)
        antiAFKEnabled = Value
        if not Value and antiAFKConnection then
            antiAFKConnection:Disconnect()
            antiAFKConnection = nil
        end
    end,
})

-- Selling Tab Elements (tidak diubah)
SellingTab:CreateSection("Sell Fish by Rarity")

local rarities = {"Common", "UnCommon", "Rare", "Epic", "Legendary", "Mythical", "Secret"}
for _, rarity in ipairs(rarities) do
    SellingTab:CreateButton({
        Name = "Sell " .. rarity,
        Callback = function()
            sellRarity(rarity)
        end,
    })
end

-- Teleport Tab Elements
TeleportTab:CreateSection("Teleport Locations")

local teleports = {
    {"Pulau ditengah laut", CFrame.new(-2445.55884, -165.058807, 4454.30762, -0.76892525, -3.90055739e-08, -0.639338732, 5.04065722e-09, 1, -6.70715892e-08, 0.639338732, -5.47957235e-08, -0.76892525)},
    {"Camp", CFrame.new(65.7638931, -91.0923462, 5332.22705)},
    {"Toko Pancingan", CFrame.new(965.361572, -147.673538, 3707.81665)},
    {"Pameran", CFrame.new(1236.47827, -91.8025131, 2891.3811)},
    {"Mercusuar", CFrame.new(-157.251251, -152.903946, 3608.63208)},
    {"Cassino", CFrame.new(1046.57214, -143.381668, 3246.20776)},
    {"Dermaga 1", CFrame.new(378.228333, -160.766098, 3560.79517)},
    {"Dermaga 2", CFrame.new(428.08902, -164.649597, 3150.53003)},
    {"Secret Location", CFrame.new(-2372.63379, -165.760818, 5119.20605, 0.779839754, 9.30003026e-08, 0.625979185, -3.60900714e-08, 1, -1.03607e-07, -0.625979185, 5.82052238e-08, 0.779839754)}
}

for _, v in ipairs(teleports) do
    TeleportTab:CreateButton({
        Name = "Teleport to " .. v[1],
        Callback = function()
            if character and character:FindFirstChild("HumanoidRootPart") then
                character.HumanoidRootPart.CFrame = v[2]
                Rayfield:Notify({
                    Title = "Teleported",
                    Content = "Teleported to " .. v[1] .. ".",
                    Duration = 3,
                })
            end
        end,
    })
end

-- Final notification
Rayfield:Notify({
    Title = "Loaded Successfully",
    Content = "SENJA AUTOFISH V1 (Final) is ready!",
    Duration = 5,
})
